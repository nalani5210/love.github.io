(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(r){var s=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var g=r.Pos;var p={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function u(e,t,n,r){var i=e.getLineHandle(t.line),a=t.ch-1;var o=a>=0&&p[i.text.charAt(a)]||p[i.text.charAt(++a)];if(!o)return null;var c=o.charAt(1)==">"?1:-1;if(n&&c>0!=(a==t.ch))return null;var f=e.getTokenTypeAt(g(t.line,a+1));var l=h(e,g(t.line,a+(c>0?1:0)),c,f||null,r);if(l==null)return null;return{from:g(t.line,a),to:l&&l.pos,match:l&&l.ch==o.charAt(0),forward:c>0}}function h(e,t,n,r,i){var a=i&&i.maxScanLineLength||1e4;var o=i&&i.maxScanLines||1e3;var c=[];var f=i&&i.bracketRegex?i.bracketRegex:/[(){}[\]]/;var l=n>0?Math.min(t.line+o,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-o);for(var s=t.line;s!=l;s+=n){var u=e.getLine(s);if(!u)continue;var h=n>0?0:u.length-1,m=n>0?u.length:-1;if(u.length>a)continue;if(s==t.line)h=t.ch-(n<0?1:0);for(;h!=m;h+=n){var v=u.charAt(h);if(f.test(v)&&(r===undefined||e.getTokenTypeAt(g(s,h+1))==r)){var d=p[v];if(d.charAt(1)==">"==n>0)c.push(v);else if(!c.length)return{pos:g(s,h),ch:v};else c.pop()}}}return s-n==(n>0?e.lastLine():e.firstLine())?false:null}function t(e,t,n){var r=e.state.matchBrackets.maxHighlightLineLength||1e3;var i=[],a=e.listSelections();for(var o=0;o<a.length;o++){var c=a[o].empty()&&u(e,a[o].head,false,n);if(c&&e.getLine(c.from.line).length<=r){var f=c.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";i.push(e.markText(c.from,g(c.from.line,c.from.ch+1),{className:f}));if(c.to&&e.getLine(c.to.line).length<=r)i.push(e.markText(c.to,g(c.to.line,c.to.ch+1),{className:f}))}}if(i.length){if(s&&e.state.focused)e.focus();var l=function(){e.operation(function(){for(var e=0;e<i.length;e++)i[e].clear()})};if(t)setTimeout(l,800);else return l}}var n=null;function i(e){e.operation(function(){if(n){n();n=null}n=t(e,false,e.state.matchBrackets)})}r.defineOption("matchBrackets",false,function(e,t,n){if(n&&n!=r.Init)e.off("cursorActivity",i);if(t){e.state.matchBrackets=typeof t=="object"?t:{};e.on("cursorActivity",i)}});r.defineExtension("matchBrackets",function(){t(this,true)});r.defineExtension("findMatchingBracket",function(e,t,n){return u(this,e,t,n)});r.defineExtension("scanForBracket",function(e,t,n,r){return h(this,e,t,n,r)})});